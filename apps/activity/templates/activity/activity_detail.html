{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load render_table from django_tables2 %}
{% load pretty_money %}
{% load perms %}

{% block content %}

    {% include "activity/activity_info.html" %}

    {% if guests.data %}
        <hr>
        <h2>{% trans "Guests list" %}</h2>
        <div id="guests_table">
            {% render_table guests %}
        </div>
    {% endif %}

{% endblock %}

{% block extrajavascript %}
<script>
    function remove_guest(guest_id) {
        $.ajax({
         url:"/api/activity/guest/" + guest_id + "/",
         method:"DELETE",
         headers: {"X-CSRFTOKEN": CSRF_TOKEN}
     })
      .done(function() {
          addMsg('Invité supprimé','success');
          $("#guests_table").load(location.pathname + " #guests_table");
      })
      .fail(function(xhr, textStatus, error) {
          errMsg(xhr.responseJSON);
      });
    }

    $("#open_activity").click(function() {
        $.ajax({
            url: "/api/activity/activity/{{ activity.pk }}/",
            type: "PATCH",
            dataType: "json",
            headers: {
                "X-CSRFTOKEN": CSRF_TOKEN
            },
            data: {
                open: {{ activity.open|yesno:'false,true' }}
            }
        }).done(function () {
            reloadWithTurbolinks();
        }).fail(function (xhr) {
            errMsg(xhr.responseJSON);
        });
    });

    $("#validate_activity").click(function () {
        $.ajax({
            url: "/api/activity/activity/{{ activity.pk }}/",
            type: "PATCH",
            dataType: "json",
            headers: {
                "X-CSRFTOKEN": CSRF_TOKEN
            },
            data: {
                valid: {{ activity.valid|yesno:'false,true' }}
            }
        }).done(function () {
            reloadWithTurbolinks();
        }).fail(function (xhr) {
            errMsg(xhr.responseJSON);
        });
    });
</script>
{% endblock %}
